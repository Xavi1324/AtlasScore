@model SimuladorViewModel
@{
    ViewData["Title"] = "Simulador de Ranking";
    var sumaPesos = ViewBag.SumaPesos as decimal?;
    var successMessage = TempData["SuccessMessage"] as string;
    var errorMessage = TempData["ErrorMessage"] as string;
}

<div class="container mt-4">
    <h2 class="mb-4">@ViewData["Title"]</h2>

    @if (!string.IsNullOrEmpty(successMessage))
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @successMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @errorMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    <form asp-action="Simulacion" method="post">
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th>Macroindicador</th>
                    <th>Peso simulado</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.PesosSimulados.Count; i++)
                {
                    <tr>
                        <td>
                            @Model.PesosSimulados[i].Nombre
                            <input type="hidden" asp-for="PesosSimulados[@i].MacroindicadorId" />
                            <input type="hidden" asp-for="PesosSimulados[@i].Nombre" />
                            <input type="hidden" asp-for="PesosSimulados[@i].EsMejorMasAlto" />
                        </td>
                        <td>
                            <input asp-for="PesosSimulados[@i].Peso" class="form-control" step="0.01" min="0" max="1" />
                            <span asp-validation-for="PesosSimulados[@i].Peso" class="text-danger"></span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <div class="mb-3">
            <strong>Suma total de pesos:</strong>
            @Model.PesosSimulados.Sum(p => p.Peso).ToString("0.###")
        </div>

        <button type="submit" class="btn btn-primary">Simular</button>
    </form>
    <hr />

    @if (Model.Resultados != null && Model.Resultados.Any())
    {
        <h4>Resultados simulados</h4>
        <table class="table table-striped table-bordered">
            <thead class="table-light">
                <tr>
                    <th>País</th>
                    <th>Scoring</th>
                    <th>Tasa estimada</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var r in Model.Resultados)
                {
                    <tr>
                        <td>@r.Pais</td>
                        <td>@r.Scoring.ToString("0.####")</td>
                        <td>@r.TasaEstimacion.ToString("0.##")%</td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

